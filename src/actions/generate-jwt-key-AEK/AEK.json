{
  "category": "data (things)",
  "code": {
    "automatically_added_packages": "{\"node:util\":\"latest\"}",
    "package": {
      "fn": "{\n    \"dependencies\": {\n        \"node:util\": \"latest\",\n        \"jsonwebtoken\": \"latest\"\n    }\n}",
      "invalid_package": false
    },
    "package_hash": "9934a31acfc0ff0b53bc",
    "package_status": "out_of_date",
    "package_used": true,
    "server": {
      "fn": "function(properties, context) {\n\n    const jsonwebtoken = require('jsonwebtoken');\n    const { inspect } = require('node:util');\n\n    const doc = properties.docID;\n    const docList = properties.docIDList;\n\n    let allowedDocumentNames = [];\n\tif (!!doc) allowedDocumentNames.push(doc);\n\tif (!!docList) allowedDocumentNames.push(docList);\n    const data = {\n        allowedDocumentNames: allowedDocumentNames\n    }\n    let key;\n    if (properties.jwt_secret === \"Tiptap Cloud\") key = context.keys[\"Tiptap Cloud JWT secret\"]\n    if (properties.jwt_secret === \"Custom\") key = context.keys[\"Custom collab JWT secret\"]\n\n    try {\n        const jwt = jsonwebtoken.sign(data, key);\n\n        return {\n            jwt_key: jwt,\n            error: \"\",\n            returned_an_error: false\n\n        }\n    } catch (error) {\n        console.log(\"error when creating JWT token\", inspect(error) );\n        return {\n            jwt_key: \"\",\n            error: \"there was an error retrieving the jwt keys.\\n\" + inspect(error),\n            returned_an_error: true\n        }\n\n    }\n}"
    }
  },
  "display": "generate JWT key",
  "fields": {
    "AEL": {
      "caption": "Doc ID",
      "doc": "the document's unique ID. This will be the name of the document that you will see on 𝗵𝘁𝘁𝗽𝘀://𝗰𝗼𝗹𝗹𝗮𝗯.𝘁𝗶𝗽𝘁𝗮𝗽.𝗱𝗲𝘃",
      "editor": "DynamicValue",
      "name": "docID",
      "optional": true,
      "rank": 0,
      "value": "text"
    },
    "AEY": {
      "caption": "Doc ID (list)",
      "doc": "Doc ids list",
      "editor": "DynamicValue",
      "is_list": true,
      "name": "docIDList",
      "optional": true,
      "rank": 1,
      "value": "text"
    },
    "jwt_secret": {
      "caption": "Which JWT secret to use",
      "default_val": "Tiptap Cloud",
      "doc": "Key to use to sign the JWT key",
      "editor": "Dropdown",
      "name": "jwt_secret",
      "optional": true,
      "options": "Tiptap Cloud,Custom",
      "rank": 2
    }
  },
  "return_value": {
    "AEM": {
      "caption": "jwt key",
      "name": "jwt_key",
      "rank": 0,
      "value": "text"
    },
    "AEZ": {
      "caption": "error",
      "name": "error",
      "rank": 1,
      "value": "text"
    },
    "AEa": {
      "caption": "returned_an_error",
      "name": "returned_an_error",
      "rank": 2,
      "value": "boolean"
    }
  },
  "type": "server_side"
}